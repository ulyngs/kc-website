---
title: "Songlist"
weight: 2
header_menu: true
params:
  fetch: no
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
library(reactable)
library(tidyverse)
library(htmltools)
library(jsonlite)

# Read from local JSON metadata backup file
songlist <- fromJSON(here::here("songbook-metadata-2026-01-31.json")) |>
  as_tibble() |>
  rename(song_title = title, is_xmas = isXmas)

# Filter out Christmas songs by default
songlist_all <- songlist |> distinct(song_title, artist, is_xmas)
songlist <- songlist_all |> filter(is.na(is_xmas) | is_xmas != TRUE)
```

```{css}
#songlist-table .rt-search {
  display: none;
}
#songlist-table {
  border-bottom: 1px solid white;
  font-size: 0.95em;
}
#search-row {
  display: flex;
  align-items: center;
  gap: 16px;
  margin-top: 0.5em;
  margin-bottom: 5px;
}
@media (max-width: 600px) {
  #search-row {
    flex-direction: column;
    align-items: stretch;
    gap: 4px;
  }
  #custom-search {
    width: 100% !important;
    box-sizing: border-box;
  }
  #xmas-toggle-container {
    justify-content: flex-start;
  }
}
#custom-search {
  flex: 1;
  background-color: rgba(255, 255, 255, 0.15);
  border: 2px solid rgba(255, 255, 255, 0.3);
  border-radius: 8px;
  padding: 6px 8px;
  color: white;
  font-size: 0.9em;
  outline: none;
  transition: all 0.2s ease;
}
#custom-search::placeholder {
  color: rgba(255, 255, 255, 0.7);
}
#custom-search:focus {
  background-color: rgba(255, 255, 255, 0.2);
  border-color: rgba(255, 255, 255, 0.5);
}
#title-block-header {
  margin-top: 1em;
  margin-bottom: 2em;
}
h1.title, .title {
  padding-bottom: 0.5em;
}
#xmas-toggle-container {
  display: flex;
  align-items: center;
  gap: 10px;
  white-space: nowrap;
  height: 100%;
}
#xmas-toggle-container > label {
  display: flex;
  align-items: center;
  gap: 8px;
  font-size: 0.9em;
}
.xmas-toggle {
  position: relative;
  display: inline-block;
  width: 52px;
  height: 28px;
}
.xmas-toggle input {
  opacity: 0;
  width: 0;
  height: 0;
}
.slider {
  position: absolute;
  cursor: pointer;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: rgba(255, 255, 255, 0.25);
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  border-radius: 28px;
  border: 2px solid rgba(255, 255, 255, 0.3);
  box-shadow: inset 0 1px 3px rgba(0, 0, 0, 0.1);
}
.slider:hover {
  background: rgba(255, 255, 255, 0.35);
  border-color: rgba(255, 255, 255, 0.5);
}
.slider:before {
  position: absolute;
  content: "";
  height: 20px;
  width: 20px;
  left: 2px;
  bottom: 2px;
  background: white;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  border-radius: 50%;
  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
}
input:checked + .slider {
  background: linear-gradient(135deg, #2d5a27 0%, #1e7b1e 100%);
  border-color: rgba(255, 255, 255, 0.4);
  box-shadow: inset 0 1px 3px rgba(0, 0, 0, 0.1), 0 0 8px rgba(30, 123, 30, 0.4);
}
input:checked + .slider:before {
  transform: translateX(24px);
  box-shadow: 0 2px 6px rgba(0, 0, 0, 0.25);
}
#songlist-table .rt-table {
  background: #b80135;
}
```


```{r}
# Create the table data with all songs and xmas info
songlist_table_data <- songlist_all |>
  select(Song = song_title, Artist = artist, is_xmas)

songlist_table <- songlist_table_data |>
  select(Song, Artist) |>
  reactable(
    elementId = "songlist-table",
    searchable = TRUE,
    pagination = FALSE,
    height = 800,
    borderless = TRUE
  )

# Calculate counts
total_songs <- nrow(songlist_all |> filter(is.na(is_xmas) | is_xmas != TRUE))
xmas_songs <- nrow(songlist_all |> filter(is_xmas == TRUE))

tagList(
  # Search row with toggle
  div(
    id = "search-row",
    tags$input(
      type = "text",
      class = "rt-search",
      id = "custom-search",
      placeholder = glue::glue("Search {total_songs} songs"),
      oninput = "Reactable.setSearch('songlist-table', this.value)"
    ),
    div(
      id = "xmas-toggle-container",
      tags$label(
        "ðŸŽ„ Xmas songs",
        tags$label(
          class = "xmas-toggle",
          tags$input(type = "checkbox", id = "xmas-toggle"),
          tags$span(class = "slider")
        )
      )
    )
  ),
  songlist_table,

  # JavaScript for toggle functionality
  tags$script(HTML(sprintf("
      // Store the full dataset
      const allSongs = %s;
      const regularSongs = allSongs.filter(song => !song.is_xmas || song.is_xmas === null);
      const xmasSongs = allSongs.filter(song => song.is_xmas === true);

      // Function to update table
      function updateTable(showXmasOnly) {
        const data = showXmasOnly ? xmasSongs : regularSongs;
        const table = document.getElementById('songlist-table');
        const searchInput = document.getElementById('custom-search');

        // Update search placeholder
        searchInput.placeholder = `Search ${data.length} songs`;

        // Update the reactable table
        Reactable.setData('songlist-table', data.map(song => ({
          Song: song.Song,
          Artist: song.Artist
        })));
      }

      // Toggle event listener
      document.getElementById('xmas-toggle').addEventListener('change', function() {
        updateTable(this.checked);
      });
    ", jsonlite::toJSON(songlist_table_data))))
)
```
